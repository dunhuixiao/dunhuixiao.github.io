var RoughNotation=function(t){"use strict";const g="http://www.w3.org/2000/svg";class e{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}function d(t,e,s,i,n){return{type:"path",ops:a(t,e,s,i,n)}}function p(e,t,s){const i=(e||[]).length;if(i>2){const d=[];for(let t=0;t<i-1;t++)d.push(...a(e[t][0],e[t][1],e[t+1][0],e[t+1][1],s));return t&&d.push(...a(e[i-1][0],e[i-1][1],e[0][0],e[0][1],s)),{type:"path",ops:d}}return 2===i?d(e[0][0],e[0][1],e[1][0],e[1][1],s):{type:"path",ops:[]}}function _(t,e,s,i,n){return function(t,e){return p(t,!0,e)}([[t,e],[t+s,e],[t+s,e+i],[t,e+i]],n)}function m(t,e,s,i,n){return function(t,e,s,i){const[n,o]=f(i.increment,t,e,i.rx,i.ry,1,i.increment*h(.1,h(.4,1,s),s),s);let r=u(n,null,s);if(!s.disableMultiStroke){const[n]=f(i.increment,t,e,i.rx,i.ry,1.5,0,s),o=u(n,null,s);r=r.concat(o)}return{estimatedPoints:o,opset:{type:"path",ops:r}}}(t,e,n,function(t,e,s){const i=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),n=Math.max(s.curveStepCount,s.curveStepCount/Math.sqrt(200)*i),o=2*Math.PI/n;let r=Math.abs(t/2),h=Math.abs(e/2);const a=1-s.curveFitting;return r+=v(r*a,s),h+=v(h*a,s),{increment:o,rx:r,ry:h}}(s,i,n)).opset}function w(t){return t.randomizer||(t.randomizer=new e(t.seed||0)),t.randomizer.next()}function h(t,e,s,i=1){return s.roughness*i*(w(s)*(e-t)+t)}function v(t,e,s=1){return h(-t,t,e,s)}function a(t,e,s,i,n,o=!1){const r=o?n.disableMultiStrokeFill:n.disableMultiStroke,h=c(t,e,s,i,n,!0,!1);if(r)return h;const a=c(t,e,s,i,n,!0,!0);return h.concat(a)}function c(t,e,s,i,n,o,r){const h=Math.pow(t-s,2)+Math.pow(e-i,2),a=Math.sqrt(h);let c=1;c=a<200?1:a>500?.4:-.0016668*a+1.233334;let u=n.maxRandomnessOffset||0;u*u*100>h&&(u=a/10);const f=u/2,l=.2+.2*w(n);let g=n.bowing*n.maxRandomnessOffset*(i-e)/200,d=n.bowing*n.maxRandomnessOffset*(t-s)/200;g=v(g,n,c),d=v(d,n,c);const p=[],_=()=>v(f,n,c),m=()=>v(u,n,c);return o&&(r?p.push({op:"move",data:[t+_(),e+_()]}):p.push({op:"move",data:[t+v(u,n,c),e+v(u,n,c)]})),r?p.push({op:"bcurveTo",data:[g+t+(s-t)*l+_(),d+e+(i-e)*l+_(),g+t+2*(s-t)*l+_(),d+e+2*(i-e)*l+_(),s+_(),i+_()]}):p.push({op:"bcurveTo",data:[g+t+(s-t)*l+m(),d+e+(i-e)*l+m(),g+t+2*(s-t)*l+m(),d+e+2*(i-e)*l+m(),s+m(),i+m()]}),p}function u(i,t,n){const o=i.length,r=[];if(o>3){const e=[],s=1-n.curveTightness;r.push({op:"move",data:[i[1][0],i[1][1]]});for(let t=1;t+2<o;t++){const n=i[t];e[0]=[n[0],n[1]],e[1]=[n[0]+(s*i[t+1][0]-s*i[t-1][0])/6,n[1]+(s*i[t+1][1]-s*i[t-1][1])/6],e[2]=[i[t+1][0]+(s*i[t][0]-s*i[t+2][0])/6,i[t+1][1]+(s*i[t][1]-s*i[t+2][1])/6],e[3]=[i[t+1][0],i[t+1][1]],r.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[3][0],e[3][1]]})}if(t&&2===t.length){const i=n.maxRandomnessOffset;r.push({op:"lineTo",data:[t[0]+v(i,n),t[1]+v(i,n)]})}}else 3===o?(r.push({op:"move",data:[i[1][0],i[1][1]]}),r.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[2][0],i[2][1]]})):2===o&&r.push(...a(i[0][0],i[0][1],i[1][0],i[1][1],n));return r}function f(e,s,i,n,o,r,t,h){const a=[],c=[],u=v(.5,h)-Math.PI/2;c.push([v(r,h)+s+.9*n*Math.cos(u-e),v(r,h)+i+.9*o*Math.sin(u-e)]);for(let t=u;t<2*Math.PI+u-.01;t+=e){const e=[v(r,h)+s+n*Math.cos(t),v(r,h)+i+o*Math.sin(t)];a.push(e),c.push(e)}return c.push([v(r,h)+s+n*Math.cos(u+2*Math.PI+.5*t),v(r,h)+i+o*Math.sin(u+2*Math.PI+.5*t)]),c.push([v(r,h)+s+.98*n*Math.cos(u+t),v(r,h)+i+.98*o*Math.sin(u+t)]),c.push([v(r,h)+s+.9*n*Math.cos(u+.5*t),v(r,h)+i+.9*o*Math.sin(u+.5*t)]),[c,a]}function b(t,e){return{maxRandomnessOffset:2,roughness:"highlight"===t?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,combineNestedSvgPaths:!1,disableMultiStroke:"double"!==t,disableMultiStrokeFill:!1,seed:e}}function l(e,i,n,o,r,h){const a=[];let t=n.strokeWidth||2;const s=function(t){const e=t.padding;if(e||0===e){if("number"==typeof e)return[e,e,e,e];if(Array.isArray(e)){const t=e;if(t.length)switch(t.length){case 4:return[...t];case 1:return[t[0],t[0],t[0],t[0]];case 2:return[...t,...t];case 3:return[...t,t[1]];default:return[t[0],t[1],t[2],t[3]]}}}return[5,5,5,5]}(n),c=void 0===n.animate||!!n.animate,u=n.iterations||2,f=n.rtl?1:0,l=b("single",h);switch(n.type){case"underline":{const e=i.y+i.h+s[2];for(let t=f;t<u+f;t++)t%2?a.push(d(i.x+i.w,e,i.x,e,l)):a.push(d(i.x,e,i.x+i.w,e,l));break}case"strike-through":{const e=i.y+i.h/2;for(let t=f;t<u+f;t++)t%2?a.push(d(i.x+i.w,e,i.x,e,l)):a.push(d(i.x,e,i.x+i.w,e,l));break}case"box":{const e=i.x-s[3],g=i.y-s[0],d=i.w+(s[1]+s[3]),p=i.h+(s[0]+s[2]);for(let t=0;t<u;t++)a.push(_(e,g,d,p,l));break}case"bracket":{const e=Array.isArray(n.brackets)?n.brackets:n.brackets?[n.brackets]:["right"],g=i.x-2*s[3],d=i.x+i.w+2*s[1],_=i.y-2*s[0],m=i.y+i.h+2*s[2];for(const n of e){let t;switch(n){case"bottom":t=[[g,i.y+i.h],[g,m],[d,m],[d,i.y+i.h]];break;case"top":t=[[g,i.y],[g,_],[d,_],[d,i.y]];break;case"left":t=[[i.x,_],[g,_],[g,m],[i.x,m]];break;case"right":t=[[i.x+i.w,_],[d,_],[d,m],[i.x+i.w,m]]}t&&a.push(p(t,!1,l))}break}case"crossed-off":{const e=i.x,g=i.y,p=e+i.w,_=g+i.h;for(let t=f;t<u+f;t++)t%2?a.push(d(p,_,e,g,l)):a.push(d(e,g,p,_,l));for(let t=f;t<u+f;t++)t%2?a.push(d(e,_,p,g,l)):a.push(d(p,g,e,_,l));break}case"circle":{const e=b("double",h),g=i.w+(s[1]+s[3]),d=i.h+(s[0]+s[2]),p=i.x-s[3]+g/2,_=i.y-s[0]+d/2,n=Math.floor(u/2),o=u-2*n;for(let t=0;t<n;t++)a.push(m(p,_,g,d,e));for(let t=0;t<o;t++)a.push(m(p,_,g,d,l));break}case"highlight":{const e=b("highlight",h);t=.95*i.h;const g=i.y+i.h/2;for(let t=f;t<u+f;t++)t%2?a.push(d(i.x+i.w,g,i.x,g,e)):a.push(d(i.x,g,i.x+i.w,g,e));break}}if(a.length){const i=function(e){const i=[];for(const t of e){let s="";for(const e of t.ops){const t=e.data;switch(e.op){case"move":s.trim()&&i.push(s.trim()),s=`M${t[0]} ${t[1]} `;break;case"bcurveTo":s+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":s+=`L${t[0]} ${t[1]} `}}s.trim()&&i.push(s.trim())}return i}(a),d=[],p=[];let s=0;const m=(t,e,s)=>t.setAttribute(e,s);for(const o of i){const i=document.createElementNS(g,"path");if(m(i,"d",o),m(i,"fill","none"),m(i,"stroke",n.color||"currentColor"),m(i,"stroke-width",""+t),c){const e=i.getTotalLength();d.push(e),s+=e}e.appendChild(i),p.push(i)}if(c){let e=0;for(let t=0;t<p.length;t++){const i=p[t],m=d[t],n=s?r*(m/s):0,h=o+e,a=i.style;a.strokeDashoffset=""+m,a.strokeDasharray=""+m,a.animation=`rough-notation-dash ${n}ms ease-out ${h}ms forwards`,e+=n}}}}class s{constructor(t,e){this._state="unattached",this._resizing=!1,this._seed=Math.floor(Math.random()*2**31),this._lastSizes=[],this._animationDelay=0,this._resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout(()=>{this._resizing=!1,"showing"===this._state&&this.haveRectsChanged()&&this.show()},400))},this._e=t,this._config=JSON.parse(JSON.stringify(e)),this.attach()}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this.refresh())}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this.refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this.refresh())}attach(){if("unattached"===this._state&&this._e.parentElement){!function(){if(!window.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const t=this._svg=document.createElementNS(g,"svg");t.setAttribute("class","rough-annotation");const e=t.style;e.position="absolute",e.top="0",e.left="0",e.overflow="visible",e.pointerEvents="none",e.width="100px",e.height="100px";const s="highlight"===this._config.type;if(this._e.insertAdjacentElement(s?"beforebegin":"afterend",t),this._state="not-showing",s){const t=window.getComputedStyle(this._e).position;(!t||"static"===t)&&(this._e.style.position="relative")}this.attachListeners()}}detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}attachListeners(){this.detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver(e=>{for(const t of e)t.contentRect&&this._resizeListener()})),this._ro&&this._ro.observe(this._e)}haveRectsChanged(){if(this._lastSizes.length){const e=this.rects();if(e.length!==this._lastSizes.length)return!0;for(let t=0;t<e.length;t++)if(!this.isSameRect(e[t],this._lastSizes[t]))return!0}return!1}isSameRect(t,e){const s=(t,e)=>Math.round(t)===Math.round(e);return s(t.x,e.x)&&s(t.y,e.y)&&s(t.w,e.w)&&s(t.h,e.h)}isShowing(){return"not-showing"!==this._state}refresh(){this.isShowing()&&!this.pendingRefresh&&(this.pendingRefresh=Promise.resolve().then(()=>{this.isShowing()&&this.show(),delete this.pendingRefresh}))}show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&this.render(this._svg,!0);break;case"not-showing":this.attach(),this._svg&&this.render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this.detachListeners()}render(s,t){let i=this._config;t&&(i=JSON.parse(JSON.stringify(this._config)),i.animate=!1);const n=this.rects();let o=0;n.forEach(t=>o+=t.w);const r=i.animationDuration||800;let h=0;for(let e=0;e<n.length;e++){const t=r*(n[e].w/o);l(s,n[e],i,h+this._animationDelay,t,this._seed),h+=t}this._lastSizes=n,this._state="showing"}rects(){const s=[];if(this._svg)if(this._config.multiline){const e=this._e.getClientRects();for(let t=0;t<e.length;t++)s.push(this.svgRect(this._svg,e[t]))}else s.push(this.svgRect(this._svg,this._e.getBoundingClientRect()));return s}svgRect(t,e){const s=t.getBoundingClientRect(),i=e;return{x:(i.x||i.left)-(s.x||s.left),y:(i.y||i.top)-(s.y||s.top),w:i.width,h:i.height}}}return t.annotate=function(t,e){return new s(t,e)},t.annotationGroup=function(t){let e=0;for(const s of t){const t=s;t._animationDelay=e;e+=0===t.animationDuration?0:t.animationDuration||800}const s=[...t];return{show(){for(const t of s)t.show()},hide(){for(const t of s)t.hide()}}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});